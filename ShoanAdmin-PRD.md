# ShoanAdmin 管理中台 PRD

文档版本：v1.0  
编写日期：2025-10-18  
依据文件：/需求背景.md

## 1. 项目概述
- 目标：构建可扩展的管理系统脚手架，提供用户、角色、权限、菜单、日志、AI生成代码、统计、认证等核心能力。
- 成功标准：模块功能完整可用，权限控制严格一致，数据可追溯，前后端接口稳定，关键操作可审计。

## 2. 用户与角色
- 角色类型：
  - 超级管理员（SA）：拥有系统全部权限，管理角色与权限、菜单配置。
  - 管理员（Admin）：管理业务数据（用户、日志），不可修改系统权限模型。
  - 运营/访客（Ops/Viewer）：只读访问与部分操作权限，按角色授权。

## 3. 界面与导航规范（关键要求）
- 登录/注册表单靠页面右侧。
- 主界面布局：左侧固定导航（首页、用户、角色、权限、菜单、日志、AI生成代码），顶部 Header 展示 ShoanAdmin 标识与头像下拉（退出登录、个人信息、密码修改），右侧为内容区表格/图表。
- 列表页包含：信息展示、多选、筛选、编辑、新增、删除、批量删除。
- 日志页：顶部搜索条件区 + 下方格式化日志内容（不使用表格）。
- 所有新增/编辑使用弹窗（Modal）；删除/批量删除展示二次确认。

## 4. 功能范围与需求
### 4.1 首页（仪表盘）
- 展示系统关键指标：用户总数、今日活跃、在线人数、系统状态等。
- 验收：卡片化展示，数据可刷新，指标有环比/趋势。

### 4.2 用户管理
- 字段：用户名、性别、头像、电话、邮箱、创建时间、更新时间、创建人、更新人。
- 操作：新增、编辑、删除、批量删除、分配角色。
- 过滤：按关键字（姓名/邮箱/电话）、性别、时间范围。
- 校验：邮箱格式、手机号格式、用户名唯一；头像支持上传并保存URL。
- 验收：
  - 列表分页与选择批量操作可用。
  - 表单校验完整；操作记录写入日志。
  - 分配角色后权限即时生效。

### 4.3 角色管理
- 字段：角色名称、角色标识、创建/更新时间、创建/更新人。
- 操作：新增、编辑、删除、批量删除、为角色分配权限。
- 验收：角色标识唯一；变更影响到用户的权限计算。

### 4.4 权限管理
- 字段：权限名称、权限标识、权限功能（按钮级/接口级）、创建/更新信息。
- 操作：新增、编辑、删除、批量删除；权限分配到角色。
- 验收：权限标识唯一；权限粒度可到按钮与接口；变更即时生效。

### 4.5 菜单管理
- 字段：菜单名称、菜单icon、菜单路径、排序、创建/更新信息。
- 操作：新增、编辑、删除、批量删除；为菜单分配角色可见范围。
- 验收：排序生效；按角色控制菜单显隐与访问。

### 4.6 日志管理
- 搜索条件：时间周期（15分钟、4小时、一天、一周）、请求ID、接口地址。
- 展示：结构化卡片或时间轴，包含时间、用户、动作、目标、状态、耗时、请求ID。
- 验收：搜索准确；详情可展开查看原始Payload/响应；支持导出。

### 4.7 AI生成代码
- 能力：对接大模型，支持对话与代码生成；可设置代码保存路径并写入项目目录（需授权）。
- 安全：文件覆盖需二次确认；生成日志记录（时间、用户、文件路径、摘要）。
- 验收：
  - 对话与生成流程可用，支持预览与保存。
  - 保存路径可配置并校验目录合法性。

### 4.8 分配角色/权限
- 用户→角色，角色→权限，菜单→角色。
- 验收：映射关系保存后在页面与接口鉴权中体现；支持批量分配与回收。

### 4.9 个人信息与密码修改
- 个人信息：头像、昵称、邮箱、电话、性别等编辑。
- 密码修改：旧密码校验、新密码策略（长度≥8，含大小写与数字），支持登出所有设备。
- 验收：密码加密存储；修改后强制重新登录（可选）。

### 4.10 在线人数统计
- 需求：接入业务系统或会话服务，统计在线人数与趋势。
- 验收：展示当前在线与最近一小时/一天趋势图；数据刷新与稳定性。

### 4.11 注册与登录
- 注册：邮箱或手机号注册，验证码校验。
- 登录：支持邮箱/手机号+密码登录；登录失败错误提示；支持记住我。
- 验收：会话有效；权限生效；登录态过期与刷新流程正确。

## 5. 权限模型（RBAC）
- 实体关系：User 多对多 Role；Role 多对多 Permission；Menu 多对多 Role。
- 鉴权：
  - 路由/菜单：按用户角色是否具备访问权限控制显隐。
  - 按钮级：页面控件根据权限标识显示/禁用。
  - 接口级：后端校验权限标识。

## 6. 数据模型（核心字段）
- User：id、name、gender、avatarUrl、phone、email、status、createdAt、updatedAt、createdBy、updatedBy。
- Role：id、name、key、desc、createdAt、updatedAt、createdBy、updatedBy。
- Permission：id、name、key、type(button/api)、desc、createdAt、updatedAt。
- Menu：id、name、icon、path、order、visible、createdAt、updatedAt。
- Log：id、time、userId、action、targetType、targetId、requestId、apiPath、status、durationMs、ip、ua、payloadSummary。

## 7. API 约定（示例）
- 认证：POST /api/auth/login、POST /api/auth/register、POST /api/auth/logout、GET /api/auth/me
- 用户：GET/POST/PUT/DELETE /api/users，POST /api/users/:id/roles
- 角色：GET/POST/PUT/DELETE /api/roles，POST /api/roles/:id/permissions
- 权限：GET/POST/PUT/DELETE /api/permissions
- 菜单：GET/POST/PUT/DELETE /api/menus，POST /api/menus/:id/roles
- 日志：GET /api/logs?timeRange=&requestId=&apiPath=，GET /api/logs/:id
- 统计：GET /api/stats/online
- AI：POST /api/ai/generate-code，GET /api/ai/jobs/:id
- 通用：分页参数 page/size，统一响应 {code,message,data}

## 8. 校验与错误处理
- 表单：必填校验、格式校验（邮箱/手机号）、唯一性校验（用户名、角色标识、权限标识）。
- 错误：标准错误码；操作失败出现消息条与日志记录。

## 9. 非功能性需求
- 安全：密码哈希（bcrypt/argon2）、JWT/Session 管理、CSRF/XSS/SQL 注入防护、操作审计。
- 性能：列表分页≤300ms，日志搜索≤2s；并发下接口稳定。
- 兼容：现代浏览器；移动端可用但以桌面优先。
- 可运维：错误日志、慢查询、操作审计、健康检查接口。

## 10. 里程碑
- M1：项目基础框架与认证、菜单导航、仪表盘骨架。
- M2：用户/角色/权限/菜单模块与RBAC打通。
- M3：日志管理与在线统计、批量操作与导出。
- M4：AI生成代码模块与安全交互。
- M5：验收与文档、性能与安全加固、上线准备。

## 11. 验收标准（抽样）
- 权限：无权限用户无法看到菜单/按钮，接口返回403。
- 批量删除：多选后确认对话框显示选中数量，操作成功有反馈并写入日志。
- 日志搜索：按时间与请求ID筛选命中正确，详情可展开。
- AI保存：保存前显示目标路径与差异预览，确认后文件写入成功并记录操作日志。

## 12. 风险与对策
- 外部统计与AI服务依赖：提供Mock与降级方案；异常时提示与回退。
- 权限粒度定义不一致：建立统一权限命名规范与校验器。

## 13. 设计与实现参考
- UI与主题：参考《UI设计风格分析.md》，统一颜色、圆角、阴影与交互规范。
- 技术栈建议：前端 Vue3+TS+Vite+elementplus；

---
本PRD覆盖核心业务与交互规范，可作为后续详细设计、接口定义与测试用例的依据。